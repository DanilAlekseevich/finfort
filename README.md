# Инсталяция
На устройстве необходим `Docker`(https://www.docker.com/) и `Docker-compose`(https://docs.docker.com/compose/install/).
А так же `Make`.

Все переменные должны быть уже заполненны и актуальны данным `docker-compose`.

Для первого запуска необходимо выполнить:
```
make install
```

В последующие разы для запуска контейнеров, выполнить:
```
make up
```

Выключить контейнеры:
```
make down
```

# Использование

1. Войти в контейнер с PHP
```
make exec-php
```
2. Выполнить команду для запуска миграций
```
php bin/console doctrine:migrations:migrate
```

3. Получить друзей(тут возможны два варианта)
 - Запустить команду консольную команду, вместо `{userId}` необходим ID пользователя VK.
```
php bin/console call:friends {userId}
```
 - Сделать REST запрос, вместо `{userId}` необходим ID пользователя VK.
```
curl --location --request GET 'localhost:8777/api/v1/call/friends/by/userId/{userId}'
```
После этого этапа можно проверить и убедиться о создании сообщений по адресу `localhost:15672`, 
будет созданна очередь, в которой каждое сообщение это один друг.

4. Запустить консьюмера(диспатчинг)
```
php bin/console messenger:consume amqp_call_users -vv
```
Запуститься "демон" в логах которого можно увидеть обращения к API VK.

5. В таблице `call` проверить резульат.


## P.S
У себя на проектах мы используем `enqueue/eqnueue-bunlde` и `enqueue/amqp-ext`. 
Но решил что для этого задания будет излишне и взял `symfony/messanger`, 
который не раскрывает все возможности работы с RabbitMQ.
Так же решил оставить один `.env` тоже для упрощения. И много что ещё намеренно не реализовано.
